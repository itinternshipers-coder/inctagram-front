#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –≤–µ—Ç–∫–∏..."

git fetch origin

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–µ—Ç–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π develop
if git merge-base --is-ancestor origin/develop HEAD; then
  echo "‚úÖ –í–µ—Ç–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ develop"
else
  echo "‚ùå –¢–≤–æ—è –≤–µ—Ç–∫–∞ –æ—Ç—Å—Ç–∞–µ—Ç –æ—Ç develop!"
  echo ""
  echo "–í—ã–±–µ—Ä–∏ —Å–ø–æ—Å–æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:"
  echo "üîÑ 1. REBASE (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) - —á–∏—Å—Ç–∞—è –∏—Å—Ç–æ—Ä–∏—è"
  echo "   git fetch && git rebase origin/develop"
  echo ""
  echo "üîÄ 2. MERGE (–ø—Ä–æ—â–µ) - –ø—Ä–æ—Å—Ç–æ–µ —Å–ª–∏—è–Ω–∏–µ"
  echo "   git fetch && git merge origin/develop"
  echo ""
  echo "üìã 3. –Ø —É–∂–µ –æ–±–Ω–æ–≤–∏–ª –≤–µ—Ç–∫—É –≤—Ä—É—á–Ω—É—é"
  echo ""
  echo "–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø—É—à–∏ —Å–Ω–æ–≤–∞: git push --force-with-lease"
  exit 1
fi

echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞..."
pnpm exec lint && pnpm run build

if [ $? -ne 0 ]; then
  echo "‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã! –ò—Å–ø—Ä–∞–≤—å –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ–¥ –ø—É—à–µ–º."
  echo "   –õ–∏–Ω—Ç–∏–Ω–≥: npm run lint"
  echo "   –°–±–æ—Ä–∫–∞: npm run build"
  exit 1
fi

echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã! –ü—É—à–∏–º..."
