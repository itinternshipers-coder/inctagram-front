#!/usr/bin/env sh

echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –≤–µ—Ç–∫–∏..."

git fetch origin

if git merge-base --is-ancestor origin/develop HEAD; then
  echo "‚úÖ –í–µ—Ç–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ develop"
else
  echo "‚ùå –¢–≤–æ—è –≤–µ—Ç–∫–∞ –æ—Ç—Å—Ç–∞–µ—Ç –æ—Ç develop!"
  echo ""
  echo "–í—ã–±–µ—Ä–∏ —Å–ø–æ—Å–æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:"
  echo "üîÑ 1. REBASE (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)"
  echo "   git fetch && git rebase origin/develop"
  echo ""
  echo "üîÄ 2. MERGE (–ø—Ä–æ—â–µ)"
  echo "   git fetch && git merge origin/develop"
  echo ""
  echo "üìã 3. –Ø —É–∂–µ –æ–±–Ω–æ–≤–∏–ª –≤–µ—Ç–∫—É –≤—Ä—É—á–Ω—É—é"
  echo ""
  echo "–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø—É—à–∏ —Å–Ω–æ–≤–∞: git push --force-with-lease"
  exit 1
fi

echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º..."

# 1. ESLint —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã)
echo "üìù –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–Ω—Ç–∏–Ω–≥..."
pnpm eslint . --ext .js,.jsx,.ts,.tsx --cache --cache-location node_modules/.cache/eslint/

if [ $? -ne 0 ]; then
  echo "‚ùå –õ–∏–Ω—Ç–∏–Ω–≥ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω! –ò—Å–ø—Ä–∞–≤—å –æ—à–∏–±–∫–∏."
  exit 1
fi

# 2. Stylelint —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
echo "üé® –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∏–ª–∏..."
pnpm stylelint "**/*.{css,scss}" --cache --cache-location node_modules/.cache/stylelint/

if [ $? -ne 0 ]; then
  echo "‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª–µ–π –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞!"
  exit 1
fi

# 3. Next.js —Å–±–æ—Ä–∫–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à Turbopack)
echo "üèóÔ∏è  –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–±–æ—Ä–∫—É..."
pnpm run build

if [ $? -ne 0 ]; then
  echo "‚ùå –°–±–æ—Ä–∫–∞ –Ω–µ –ø—Ä–æ—à–ª–∞! –ò—Å–ø—Ä–∞–≤—å –æ—à–∏–±–∫–∏."
  exit 1
fi

echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã! –ü—É—à–∏–º..."

